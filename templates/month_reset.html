{% extends 'base.html' %}
{% set title = 'איפוס חודש' %}
{% block content %}

<div class="card border-0 shadow-sm mb-3">
  <div class="card-header section-header">
    <i class="bi bi-arrow-clockwise text-warning"></i>
    איפוס חודש — {{ today.strftime('%B %Y') }}
  </div>
  <div class="card-body">
    <p class="text-muted">
      פעולה זו תעתיק את כל הסכומים מהתבנית לחודש הנוכחי.
      פריטים משתנים מסומנים ב-<span class="badge bg-warning text-dark">משתנה</span> — יש להזין את הסכום ידנית.
    </p>

    <!-- Girls food preview -->
    <div class="alert alert-info">
      <i class="bi bi-calculator"></i>
      <strong>אוכל בנות</strong> לחודש {{ today.strftime('%B') }}:
      <strong dir="ltr">€{{ "%.2f"|format(food_cost) }}</strong>
      <div class="small text-muted mt-1">= ימי לימוד (לא יום ד') × 2 ארוחות × €5.10</div>
    </div>

    <form method="POST" action="/month-reset">

      <h6 class="mb-2">סכומים לטעינה:</h6>
      <ul class="list-group list-group-flush mb-3">
        {% for t in templates %}
          <li class="list-group-item py-2">
            <div class="d-flex justify-content-between align-items-center">

              <!-- Name + badges -->
              <div>
                <span class="fw-semibold">{{ t.name }}</span>
                {% if t.name == 'אוכל בנות' %}
                  <span class="badge bg-info text-dark me-1">מחושב</span>
                {% elif t.is_variable %}
                  <span class="badge bg-warning text-dark me-1">משתנה</span>
                {% endif %}
                {% if t.debit_day %}
                  <span class="badge bg-light text-dark border me-1">{{ t.debit_day }} לחודש</span>
                {% endif %}
              </div>

              <!-- Amount: calculated / editable / fixed -->
              {% if t.name == 'אוכל בנות' %}
                <span class="fw-bold {% if t.is_income %}text-success{% else %}text-danger{% endif %}" dir="ltr">
                  {% if t.is_income %}+{% else %}-{% endif %}€{{ "%.2f"|format(food_cost) }}
                </span>
              {% elif t.is_variable %}
                <div class="input-group input-group-sm" dir="ltr" style="max-width:130px">
                  <span class="input-group-text">€</span>
                  <input type="number" step="0.01" class="form-control"
                         name="var_{{ t.id }}"
                         value="{{ t.amount or '' }}"
                         placeholder="{{ t.amount or 'הכנס' }}" />
                </div>
              {% elif t.amount %}
                <span class="fw-bold {% if t.is_income %}text-success{% else %}text-danger{% endif %}" dir="ltr">
                  {% if t.is_income %}+{% else %}-{% endif %}€{{ "%.2f"|format(t.amount) }}
                </span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}

            </div>
          </li>
        {% endfor %}
      </ul>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" name="clear_pending" id="clearPending" />
        <label class="form-check-label" for="clearPending">
          נקה גם את רשימת האשראי לא בחשבון
        </label>
      </div>
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-warning flex-grow-1">
          <i class="bi bi-arrow-clockwise"></i> אשר איפוס
        </button>
        <a href="/" class="btn btn-outline-secondary">ביטול</a>
      </div>
    </form>
  </div>
</div>

{% endblock %}
